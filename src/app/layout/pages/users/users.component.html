<div class="container mx-auto">
  <!-- Encabezado de la página -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Gestión de Usuarios</h1>
    <p class="text-gray-600 mt-1">
      Administra los usuarios del sistema y sus roles asignados.
    </p>
  </div>

  <!-- Mensaje de éxito -->
  <div
    *ngIf="successMessage"
    class="mb-6 bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded-md"
  >
    <div class="flex">
      <div class="flex-shrink-0">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 text-emerald-500"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div class="ml-3">
        <p class="text-sm text-emerald-700">{{ successMessage }}</p>
      </div>
    </div>
  </div>

  <!-- Mensaje de error -->
  <div
    *ngIf="errorMessage"
    class="mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded-md"
  >
    <div class="flex">
      <div class="flex-shrink-0">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 text-red-500"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div class="ml-3">
        <p class="text-sm text-red-700">{{ errorMessage }}</p>
      </div>
    </div>
  </div>

  <!-- Barra de acciones -->
  <div
    class="mb-6 flex flex-col sm:flex-row justify-between items-center gap-4"
  >
    <div class="w-full sm:w-auto flex-1 max-w-md">
      <div class="relative">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="filterUsers()"
          placeholder="Buscar usuarios..."
          class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150"
        />
      </div>
    </div>
    <button
      (click)="openCreateModal()"
      class="w-full sm:w-auto px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-500 hover:from-emerald-700 hover:to-teal-600 text-white rounded-lg transition-colors duration-200 flex items-center justify-center"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-2"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
          clip-rule="evenodd"
        />
      </svg>
      Nuevo Usuario
    </button>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div
      class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"
    ></div>
  </div>

  <!-- Tabla de usuarios -->
  <div
    *ngIf="!loading"
    class="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200"
  >
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Usuario
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Documento
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Teléfono
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Rol
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let user of filteredUsers" class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div
                  class="flex-shrink-0 h-10 w-10 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-600 font-semibold"
                >
                  {{ user.name.charAt(0).toUpperCase() }}
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">
                    {{ user.name }}
                  </div>
                  <div class="text-sm text-gray-500">{{ user.username }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.document }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.phone }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                [ngClass]="{
                  'bg-blue-100 text-blue-800': user.Rol.rol === 'Admin',
                  'bg-green-100 text-green-800': user.Rol.rol === 'Prestamista',
                  'bg-purple-100 text-purple-800': user.Rol.rol === 'Prestador'
                }"
              >
                {{ user.Rol.rol }}
              </span>
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
            >
              <button
                (click)="openEditModal(user)"
                class="text-emerald-600 hover:text-emerald-900 mr-3"
                title="Editar usuario"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                  />
                </svg>
              </button>
              <button
                (click)="openDeleteModal(user)"
                [class]="
                  user.status
                    ? 'text-red-600 hover:text-red-900'
                    : 'text-emerald-600 hover:text-emerald-900'
                "
              >
                {{ user.status ? "Deshabilitar" : "Habilitar" }}
              </button>
            </td>
          </tr>

          <!-- Mensaje cuando no hay resultados -->
          <tr *ngIf="filteredUsers.length === 0">
            <td colspan="5" class="px-6 py-10 text-center text-gray-500">
              No se encontraron usuarios que coincidan con la búsqueda.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal de creación de usuario -->
  <div
    *ngIf="showCreateModal"
    class="fixed inset-0 z-50 overflow-y-auto"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
  >
    <div
      class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
    >
      <!-- Overlay de fondo -->
      <div
        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        aria-hidden="true"
      ></div>

      <!-- Centrado del modal -->
      <span
        class="hidden sm:inline-block sm:align-middle sm:h-screen"
        aria-hidden="true"
        >&#8203;</span
      >

      <!-- Modal -->
      <div
        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
      >
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
              <h3
                class="text-lg leading-6 font-medium text-gray-900"
                id="modal-title"
              >
                Crear Nuevo Usuario
              </h3>
              <div class="mt-4">
                <form
                  [formGroup]="createForm"
                  (ngSubmit)="createUser()"
                  class="space-y-4"
                >
                  <!-- Nombre -->
                  <div>
                    <label
                      for="name"
                      class="block text-sm font-medium text-gray-700"
                      >Nombre completo</label
                    >
                    <input
                      type="text"
                      id="name"
                      formControlName="name"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                      [ngClass]="{
                        'border-red-300 focus:border-red-500 focus:ring-red-500':
                          isFieldInvalid(createForm, 'name')
                      }"
                    />
                    <p
                      *ngIf="isFieldInvalid(createForm, 'name')"
                      class="mt-1 text-sm text-red-600"
                    >
                      {{ getFieldError(createForm, "name") }}
                    </p>
                  </div>

                  <!-- Documento y Teléfono -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label
                        for="document"
                        class="block text-sm font-medium text-gray-700"
                        >Documento</label
                      >
                      <input
                        type="number"
                        id="document"
                        formControlName="document"
                        (keypress)="numberOnly($event)"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(createForm, 'document')
                        }"
                        min="0"
                      />
                      <p
                        *ngIf="isFieldInvalid(createForm, 'document')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(createForm, "document") }}
                      </p>
                    </div>
                    <div>
                      <label
                        for="phone"
                        class="block text-sm font-medium text-gray-700"
                        >Teléfono</label
                      >
                      <input
                        type="number"
                        id="phone"
                        formControlName="phone"
                        (keypress)="numberOnly($event)"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(createForm, 'phone')
                        }"
                        min="0"
                      />
                      <p
                        *ngIf="isFieldInvalid(createForm, 'phone')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(createForm, "phone") }}
                      </p>
                    </div>
                  </div>

                  <!-- Username y Email -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label
                        for="username"
                        class="block text-sm font-medium text-gray-700"
                        >Nombre de usuario</label
                      >
                      <input
                        type="text"
                        id="username"
                        formControlName="username"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(createForm, 'username')
                        }"
                      />
                      <p
                        *ngIf="isFieldInvalid(createForm, 'username')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(createForm, "username") }}
                      </p>
                    </div>
                    <div>
                      <label
                        for="email"
                        class="block text-sm font-medium text-gray-700"
                        >Email</label
                      >
                      <input
                        type="email"
                        id="email"
                        formControlName="email"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(createForm, 'email')
                        }"
                      />
                      <p
                        *ngIf="isFieldInvalid(createForm, 'email')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(createForm, "email") }}
                      </p>
                    </div>
                  </div>

                  <!-- Password -->
                  <div>
                    <label
                      for="password"
                      class="block text-sm font-medium text-gray-700"
                      >Contraseña</label
                    >
                    <input
                      type="password"
                      id="password"
                      formControlName="password"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                      [ngClass]="{
                        'border-red-300 focus:border-red-500 focus:ring-red-500':
                          isFieldInvalid(createForm, 'password')
                      }"
                    />
                    <p
                      *ngIf="isFieldInvalid(createForm, 'password')"
                      class="mt-1 text-sm text-red-600"
                    >
                      {{ getFieldError(createForm, "password") }}
                    </p>
                  </div>

                  <!-- Rol -->
                  <div>
                    <label
                      for="role"
                      class="block text-sm font-medium text-gray-700"
                      >Rol</label
                    >
                    <select
                      id="role"
                      formControlName="role"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                      [ngClass]="{
                        'border-red-300 focus:border-red-500 focus:ring-red-500':
                          isFieldInvalid(createForm, 'role')
                      }"
                    >
                      <option [ngValue]="null" disabled>
                        Seleccione un rol
                      </option>
                      <option *ngFor="let role of roles" [ngValue]="role.id">
                        {{ role.rol }}
                      </option>
                    </select>
                    <p
                      *ngIf="isFieldInvalid(createForm, 'role')"
                      class="mt-1 text-sm text-red-600"
                    >
                      {{ getFieldError(createForm, "role") }}
                    </p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <button
            type="button"
            (click)="createUser()"
            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-500 hover:from-emerald-700 hover:to-teal-600 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:ml-3 sm:w-auto sm:text-sm"
            [disabled]="processing"
          >
            <svg
              *ngIf="processing"
              class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            {{ processing ? "Creando..." : "Crear Usuario" }}
          </button>
          <button
            type="button"
            (click)="closeCreateModal()"
            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de edición de usuario -->
  <div
    *ngIf="showEditModal"
    class="fixed inset-0 z-50 overflow-y-auto"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
  >
    <div
      class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
    >
      <!-- Overlay de fondo -->
      <div
        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        aria-hidden="true"
      ></div>

      <!-- Centrado del modal -->
      <span
        class="hidden sm:inline-block sm:align-middle sm:h-screen"
        aria-hidden="true"
        >&#8203;</span
      >

      <!-- Modal -->
      <div
        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
      >
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
              <h3
                class="text-lg leading-6 font-medium text-gray-900"
                id="modal-title"
              >
                Editar Usuario
              </h3>
              <div class="mt-4">
                <form
                  [formGroup]="editForm"
                  (ngSubmit)="updateUser()"
                  class="space-y-4"
                >
                  <!-- Nombre -->
                  <div>
                    <label
                      for="edit-name"
                      class="block text-sm font-medium text-gray-700"
                      >Nombre completo</label
                    >
                    <input
                      type="text"
                      id="edit-name"
                      formControlName="name"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                      [ngClass]="{
                        'border-red-300 focus:border-red-500 focus:ring-red-500':
                          isFieldInvalid(editForm, 'name')
                      }"
                    />
                    <p
                      *ngIf="isFieldInvalid(editForm, 'name')"
                      class="mt-1 text-sm text-red-600"
                    ></p>
                  </div>

                  <!-- Documento y Teléfono -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label
                        for="edit-document"
                        class="block text-sm font-medium text-gray-700"
                        >Documento</label
                      >
                      <input
                        type="number"
                        id="edit-document"
                        (keypress)="numberOnly($event)"
                        formControlName="document"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(editForm, 'document')
                        }"
                        min="0"
                      />
                      <p
                        *ngIf="isFieldInvalid(editForm, 'document')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(editForm, "document") }}
                      </p>
                    </div>
                    <div>
                      <label
                        for="edit-phone"
                        class="block text-sm font-medium text-gray-700"
                        >Teléfono</label
                      >
                      <input
                        type="number"
                        id="edit-phone"
                        formControlName="phone"
                        (keypress)="numberOnly($event)"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(editForm, 'phone')
                        }"
                        min="0"
                      />
                      <p
                        *ngIf="isFieldInvalid(editForm, 'phone')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(editForm, "phone") }}
                      </p>
                    </div>
                  </div>

                  <!-- Username y Email -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label
                        for="edit-username"
                        class="block text-sm font-medium text-gray-700"
                        >Nombre de usuario</label
                      >
                      <input
                        type="text"
                        id="edit-username"
                        formControlName="username"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(editForm, 'username')
                        }"
                      />
                      <p
                        *ngIf="isFieldInvalid(editForm, 'username')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(editForm, "username") }}
                      </p>
                    </div>
                    <div>
                      <label
                        for="edit-email"
                        class="block text-sm font-medium text-gray-700"
                        >Email</label
                      >
                      <input
                        type="email"
                        id="edit-email"
                        formControlName="email"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                        [ngClass]="{
                          'border-red-300 focus:border-red-500 focus:ring-red-500':
                            isFieldInvalid(editForm, 'email')
                        }"
                      />
                      <p
                        *ngIf="isFieldInvalid(editForm, 'email')"
                        class="mt-1 text-sm text-red-600"
                      >
                        {{ getFieldError(editForm, "email") }}
                      </p>
                    </div>
                  </div>

                  <!-- Password (opcional en edición) -->
                  <div>
                    <label
                      for="edit-password"
                      class="block text-sm font-medium text-gray-700"
                    >
                      Contraseña
                      <span class="text-gray-500 text-xs"
                        >(Dejar en blanco para mantener la actual)</span
                      >
                    </label>
                    <input
                      type="password"
                      id="edit-password"
                      formControlName="password"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                    />
                  </div>

                  <!-- Rol -->
                  <div>
                    <label
                      for="edit-role"
                      class="block text-sm font-medium text-gray-700"
                      >Rol</label
                    >
                    <select
                      id="edit-role"
                      formControlName="role"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"
                      [ngClass]="{
                        'border-red-300 focus:border-red-500 focus:ring-red-500':
                          isFieldInvalid(editForm, 'role')
                      }"
                    >
                      <option [ngValue]="null" disabled>
                        Seleccione un rol
                      </option>
                      <option *ngFor="let role of roles" [ngValue]="role.id">
                        {{ role.rol }}
                      </option>
                    </select>
                    <p
                      *ngIf="isFieldInvalid(editForm, 'role')"
                      class="mt-1 text-sm text-red-600"
                    >
                      {{ getFieldError(editForm, "role") }}
                    </p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <button
            type="button"
            (click)="updateUser()"
            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-500 hover:from-emerald-700 hover:to-teal-600 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:ml-3 sm:w-auto sm:text-sm"
            [disabled]="processing"
          >
            <svg
              *ngIf="processing"
              class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            {{ processing ? "Guardando..." : "Guardar Cambios" }}
          </button>
          <button
            type="button"
            (click)="closeEditModal()"
            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmación de eliminación -->
  <div
    *ngIf="showDeleteModal"
    class="fixed inset-0 z-50 overflow-y-auto"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
  >
    <div
      class="flex items-center justify-center min-h-screen px-3 py-4 text-center sm:block sm:p-0"
    >
      <!-- Overlay de fondo -->
      <div
        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        aria-hidden="true"
      ></div>

      <!-- Centrado del modal -->
      <span
        class="hidden sm:inline-block sm:align-middle sm:h-screen"
        aria-hidden="true"
        >&#8203;</span
      >

      <!-- Modal -->
      <div
        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all w-full sm:my-8 sm:align-middle sm:max-w-lg"
      >
        <div class="bg-white px-4 pt-4 pb-2 sm:p-6 sm:pb-4">
          <div class="flex flex-col sm:flex-row sm:items-start">
            <div class="text-center sm:text-left sm:ml-4">
              <h3
                class="text-lg leading-6 font-medium text-gray-900"
                id="modal-title"
              >
                {{
                  selectedUser?.status === true
                    ? "Deshabilitar usuario"
                    : "Habilitar usuario"
                }}
              </h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500">
                  ¿Estás seguro de que deseas
                  {{
                    selectedUser?.status === true ? "deshabilitar" : "habilitar"
                  }}
                  al usuario
                  <span class="font-medium">{{ selectedUser?.name }}</span
                  >? Esta acción no se puede deshacer.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div
          class="bg-gray-50 px-4 py-3 sm:px-6 flex flex-col-reverse sm:flex-row sm:justify-end gap-2"
        >
          <button
            type="button"
            (click)="closeDeleteModal()"
            class="w-full sm:w-auto inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 text-gray-700"
          >
            Cancelar
          </button>
          <!-- Botón dinámico -->
          <button
            type="button"
            (click)="deleteUser()"
            class="w-full text-white sm:w-auto inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2"
            [ngClass]="
              selectedUser?.status === true
                ? 'bg-red-600 hover:bg-red-700 focus:ring-red-500'
                : 'bg-emerald-600 hover:bg-emerald-700 focus:ring-emerald-500'
            "
            [disabled]="processing"
            [attr.aria-label]="
              selectedUser?.status === true
                ? 'Deshabilitar usuario'
                : 'Habilitar usuario'
            "
          >
            <svg
              *ngIf="processing"
              class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            {{
              processing
                ? selectedUser?.status === true
                  ? "Deshabilitando..."
                  : "Habilitando..."
                : selectedUser?.status === true
                ? "Deshabilitar"
                : "Habilitar"
            }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
